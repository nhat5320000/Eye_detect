import cv2
from ultralytics import YOLO
import gi
gi.require_version('Gst', '1.0')
gi.require_version('GstVideo', '1.0')
from gi.repository import Gst, GstVideo

# Khởi tạo GStreamer
Gst.init(None)

# Load YOLO model
eye_detect = YOLO("training/eyes-detect/yolov11n/yolov11_last.engine", task='detect')

# Tạo GStreamer pipeline để hiển thị video
pipeline = (
    'appsrc ! videoconvert ! video/x-raw,format=BGRx ! '
    'nvvidconv ! nveglglessink window-x=0 window-y=0 window-width=640 window-height=480'
)
out = cv2.VideoWriter(pipeline, cv2.CAP_GSTREAMER, 0, 30, (640, 480), True)

if not out.isOpened():
    print("❌ Không thể khởi tạo GStreamer pipeline!")
    exit()

# Mở camera
cap = cv2.VideoCapture(0)
if not cap.isOpened():
    print("❌ Không thể mở camera!")
    exit()

try:
    while True:
        success, frame = cap.read()
        if not success:
            break

        # Resize cho model YOLO
        frame_resized = cv2.resize(frame, (320, 320
